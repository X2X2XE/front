<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>숫자 야구 게임</title>
</head>
<body>
    <h1>
        0 ~ 9 의 중복되지 않는 정수 3개를 랜덤으로 출제하면 맞추는 게임 
    </h1>
    <h3>게임 규칙</h3>
    <ol>
        <li>
            세자리의 숫자는 각 자리수를 갖고 서로 중복되지 않는다
        </li>
        <li>
            각 자리수와 입력한 숫자의 자리수가 동일하면 1 Strike(스트라이크)
        </li>
        <li>
            입력한 숫자가 포함되어 있으나 자리수가 동일하지 않으면 1 Ball(볼)
        </li>
        <li>
            입력한 숫자가 전혀 포함되어 있지 않으면 Out(아웃)
        </li>
        <li>
            3 Strike 이면 게임 종료
        </li>
        <li>
            플레이 예시 : 컴숫자(429) > 내추측숫자(417) > 1S <br>
            컴숫자(429) > 내추측숫자 (491) > 1S 1B<br>
            컴숫자(429) > 내추측숫자 (742) > 2B<br>
            컴숫자(429) > 내추측숫자 (381) > OUT<br>

        </li>
    </ol>
    <h3>제작 규칙</h3>
    <ul>
        <li>
            1게임을 완료한 시간을 기록할 것
        </li>
        <li>
            게임을 진행하면서 숫자 추측 시도 횟수도 같이 기록할 것
        </li>
        <li>
            페이지를 리프레쉬 하거나 내부 프로그램을 종료하기 전까지의 기록을 오름차순으로
            정렬하여 출력할 것
        </li>
    </ul>
    <button type="button" id="play">시작!</button><br>
   
    중복되지 않는 3자리 정수 입력 : <input type="number" max="999" min="100" id="play_num"><button type="button" id="play_btn">검사</button><br>
    <div id="print">

    </div>
    <hr>
    <div id="time_print">

    </div>

    <script>
        function comset() {
            let com_set = new Set(); // 셋으로 만들어서 중복 없애기
            do {
                let ran = Math.floor(Math.random()*10);
                com_set.add(ran);
            } while (com_set.size  <3); // 크기가 3이상이 될 떄까지 실행
            return com_set; //셋 리턴
        }
        function comnum(set){
            let num =[];
            for (const iterator of set) {
                num.push(iterator); //셋을 가져와 배열로 넣어주기
            }
            return num; // 배열리턴
        }
        function strike(com_num, play_num){ //스트라이크 확인
            let strike = 0;
            for(let i = 0; i < play_num.length ; i++){
                if(play_num[i] == com_num[i]){
                    strike++;
                }
            }
            return strike; //스트라이크 갯수 리턴
        }
        function ball(com_num, play_num){ // 볼 확인
            let ball = 0;
            for(let i =0; i < play_num.length; i++){
                
                for(let j = 0 ;j < play_num.length; j ++){
                    if(i != j && com_num[i] == play_num[j]){
                        ball++;                        
                    }
                }
            }
            return ball; // 볼 갯수 리턴
        }





        let play_num = [];
        let com_set = new Set();
        let com_num = [];
        let start_time= [];
        let end_time = [];
        let Game = {
            //com_num : [],  
            //play_num : [],
            time : [],
            count : [],
        }
        let game_count =0;
        let end_count = 0;
        document.getElementById(`play`).addEventListener(`click`,function(){
            let start = new Date();
            start_time.push(start.getTime()); // 시작 시간 저장
            com_set = comset();
            com_num = comnum(com_set); 
            //Game.com_num.push(com_num);  필요없어짐
            console.log(com_num, start_time); // 컴퓨터 번호 확인
            document.getElementById(`print`).innerText=`컴퓨터가 숫자를 정햇습니다!`
        })  
        document.getElementById(`play_btn`).addEventListener(`click`, function(){
            let num = String(document.getElementById(`play_num`).value); // 숫자를 받아와서 string화
            //Game.play_num.push(num); 필요없어짐
            let num2 = new Set();
            
            for(let i=0; i < num.length; i++){
                play_num[i] = num[i]; // string인걸 전역변수 배열에 넣어줌
                num2.add(play_num[i]);  // Set에 넣어서 중복된거 제거 
            }
            if (!(num2.size ==3)){ // 사용자가 넣은 숫자의 크기가 3자리 인가 확인
                let print = document.getElementById(`print`);
                print.innerHTML='';
                print.innerHTML+=`<h2>올바른 정수가 아닙니다 다시 입력하세요</h2>`;
            } else {
            let st = strike(com_num, play_num); // 스트라이크 확인
            let ba = ball(com_num, play_num); // 볼 확인
            if (st==3 && ba ==0){ // 스트라이크 3
                game_count++;
                let print = document.getElementById(`print`);
                print.innerHTML = `<h3>Strike!!!!!!!!!!!! 게임 끝 횟수 : ${game_count}</h3>`;
                
                let end = new Date(); //끝난 시간 
                end_time.push(end.getTime()); //  끝난 시간 저장
                let time = (end_time[end_count]- start_time[end_count])/1000; // 경과시간 저장
                
                Game.time.push(time); // 객체에 넣어주기
                console.log(end_time,Game.time);
                end_count++; // 게임시간 저장을 위해 게임 끝낫을 때마다 카운트 증가
                Game.count.push(game_count); // 시도횟수 저장
                game_count = 0;
            } else if(st > 0 || ba > 0){  // 스트라이크와 볼이 같이 나온 상황
                game_count++; // 
                let print = document.getElementById(`print`);
                print.innerHTML = `<h3>strike : ${st}, ball : ${ba} 시도횟수 : ${game_count}</h3>`;
            } else if (st ==0 && ba == 0){ // 아무것도 안나온 아웃 상황
                game_count++;
                let print = document.getElementById(`print`);
                print.innerHTML = `<h3>OUT!!!! 시도횟수 : ${game_count}</h3>`;
            }  
            if(Game.time.length > 0){ // 게임 끝난 후 시간이 들어 온 후
                let print = document.getElementById(`time_print`);
                print.innerHTML = ''; // 매번 초기화
                Game.time.sort(function(a, b){return a-b;}) // 시간 정렬
                Game.count.sort(function(a,b){return a-b;}) // 카운트 정렬
                for(let i =0; i < Game.time.length; i++){ // 등수에 따라 출력
                    print.innerHTML+=`<h3>${i+1}등 , 시간 : ${Game.time[i]}, 횟수 : ${Game.count[i]} </h3>`;
                }
            }
        }
            


           

        })
    </script>

</body>
</html>